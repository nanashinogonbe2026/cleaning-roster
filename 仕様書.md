# 掃除当番表ローテーション V3 (Cleaning Roster V3) 仕様書

## 1. 概要
本システムは、学校や組織における掃除当番、日直、スピーチ等の役割を自動的に割り振るWebアプリケーションです。
「Stream & Debt（ストリーム＆負債）」モデルを採用し、欠席や休日によるズレを最小限に抑えつつ、公平な役割分担を実現します。

## 2. システム構成
- **プラットフォーム**: Webブラウザ (Chrome, Edge, Safari等)
- **技術スタック**:
    - HTML5
    - CSS3 (Tailwind CSS - CDN版)
    - JavaScript (Vanilla JS - ES6+)
- **データ保存**: ブラウザの `localStorage` (ローカルストレージ)
- **依存ライブラリ**: Tailwind CSS (スタイリングのみ)

## 3. 機能要件

### 3.1 役割 (Roles)
以下の役割を管理します。
1. **日直 (Nichoku)**: 1名/日
2. **スピーチ (Speech)**: 1名/日
3. **コメント (Comment)**: 1名/日
4. **掃除 (Cleaning)**: 2名/日 (掃除A, 掃除B)

### 3.2 アルゴリズム (Stream & Debt Model)

#### 基本ロジック
各役割には「ポインタ（現在誰の番かを示すインデックス）」が存在します。
毎日、ポインタの位置からメンバーを探索し、割り振りを行います。

#### 負債 (Debt) システム
- 当番の日に欠席した場合、または他の役割と重複してスキップされた場合、そのメンバーに「負債」が記録されます。
- 次回の割り当て時、ポインタ進行よりも**「負債を持っているメンバー」の解消**が優先されます。
- これにより、「休んだから免除」ではなく「後で必ず回ってくる」公平性を担保します。

#### 掃除当番のスライド方式 (Sliding Window)
- 掃除当番は2名体制ですが、ペアを固定せず、毎日1名ずつずらして構成します。
- **例**: 
  - 1日目: 生徒4, 生徒5
  - 2日目: 生徒5, 生徒6
  - 3日目: 生徒6, 生徒7
- これを実現するため、掃除用のポインタは毎日「+1」ずつ進みます（割り当て人数に関わらず）。

### 3.3 競合回避ルール
同一人物が同じ日に複数の役割を持つことを防ぎます。
- **OK**: 日直 ＋ 掃除 (または他)
- **NG**: スピーチ ＋ コメント
- **NG**: 掃除 ＋ 掃除

### 3.4 休日・欠席管理
- **休日設定**: カレンダー上で特定の日を「休日」に設定可能（割り当てなし）。
- **掃除なし設定**: 特定の日を「掃除なし」に設定可能（日直等はあり）。
- **手動欠席**: 事前に欠席がわかっている場合、カレンダー上でメンバーを「欠席」扱いにでき、当番をスキップ（負債化）させます。

## 4. データ構造 (State Manager)

### Members (メンバーリスト)
```json
[
  { "studentNumber": 1, "name": "生徒1", "active": true },
  { "studentNumber": 2, "name": "生徒2", "active": true },
  ...
]
```

### Pointers (進行状況)
```json
{
  "nichoku": 0,
  "speech": 0,
  "comment": 0,
  "clean": 0
}
```

### Debts (負債データ)
```json
{
  "生徒名": {
    "nichoku": 1, // 日直を1回スキップした
    "clean": 0
  }
}
```

## 5. UI/UX デザイン
- **テーマ**: ダークモード（目に優しい配色）
- **レスポンシブ**: PCおよびタブレットでの閲覧を推奨
- **操作性**: 
    - メンバー名クリックで即座に「欠席」トグル
    - 休日ボタンで即座にスケジュール再計算

## 6. データ永続化とバックアップ
- **自動保存**: 操作ごとに `localStorage` に即時保存されます。
- **エクスポート**: 手動でJSONファイルとして全データをダウンロード可能。
- **インポート**: JSONファイルを読み込み、データを復元可能（別端末への移行用）。
